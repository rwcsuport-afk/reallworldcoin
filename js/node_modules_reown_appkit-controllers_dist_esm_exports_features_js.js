"use strict";
(self["webpackChunk"] = self["webpackChunk"] || []).push([["node_modules_reown_appkit-controllers_dist_esm_exports_features_js"],{

/***/ "./node_modules/@reown/appkit-controllers/dist/esm/exports/features.js":
/*!*****************************************************************************!*\
  !*** ./node_modules/@reown/appkit-controllers/dist/esm/exports/features.js ***!
  \*****************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ReownAuthentication: () => (/* reexport safe */ _src_features_reown_authentication_index_js__WEBPACK_IMPORTED_MODULE_0__.ReownAuthentication),
/* harmony export */   ReownAuthenticationMessenger: () => (/* reexport safe */ _src_features_reown_authentication_index_js__WEBPACK_IMPORTED_MODULE_0__.ReownAuthenticationMessenger)
/* harmony export */ });
/* harmony import */ var _src_features_reown_authentication_index_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../src/features/reown-authentication/index.js */ "./node_modules/@reown/appkit-controllers/dist/esm/src/features/reown-authentication/index.js");

//# sourceMappingURL=features.js.map

/***/ }),

/***/ "./node_modules/@reown/appkit-controllers/dist/esm/src/features/reown-authentication/ReownAuthentication.js":
/*!******************************************************************************************************************!*\
  !*** ./node_modules/@reown/appkit-controllers/dist/esm/src/features/reown-authentication/ReownAuthentication.js ***!
  \******************************************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ReownAuthentication: () => (/* binding */ ReownAuthentication)
/* harmony export */ });
/* harmony import */ var _reown_appkit_common__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @reown/appkit-common */ "./node_modules/@reown/appkit-common/dist/esm/src/utils/ConstantsUtil.js");
/* harmony import */ var _reown_appkit_common__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @reown/appkit-common */ "./node_modules/@reown/appkit-common/dist/esm/src/utils/SafeLocalStorage.js");
/* harmony import */ var _controllers_AccountController_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ../../controllers/AccountController.js */ "./node_modules/@reown/appkit-controllers/dist/esm/src/controllers/AccountController.js");
/* harmony import */ var _controllers_ApiController_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../../controllers/ApiController.js */ "./node_modules/@reown/appkit-controllers/dist/esm/src/controllers/ApiController.js");
/* harmony import */ var _controllers_BlockchainApiController_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../../controllers/BlockchainApiController.js */ "./node_modules/@reown/appkit-controllers/dist/esm/src/controllers/BlockchainApiController.js");
/* harmony import */ var _controllers_ChainController_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../../controllers/ChainController.js */ "./node_modules/@reown/appkit-controllers/dist/esm/src/controllers/ChainController.js");
/* harmony import */ var _utils_ChainControllerUtil_js__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../../utils/ChainControllerUtil.js */ "./node_modules/@reown/appkit-controllers/dist/esm/src/utils/ChainControllerUtil.js");
/* harmony import */ var _ReownAuthenticationMessenger_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ./ReownAuthenticationMessenger.js */ "./node_modules/@reown/appkit-controllers/dist/esm/src/features/reown-authentication/ReownAuthenticationMessenger.js");
//







/**
 * This is the configuration for using SIWX with Reown Authentication service.
 * It allows you to authenticate and capture user sessions through the Cloud Dashboard.
 */
class ReownAuthentication {
    constructor(params = {}) {
        this.otpUuid = null;
        this.listeners = {
            sessionChanged: []
        };
        this.localAuthStorageKey =
            params.localAuthStorageKey ||
                _reown_appkit_common__WEBPACK_IMPORTED_MODULE_1__.SafeLocalStorageKeys.SIWX_AUTH_TOKEN;
        this.localNonceStorageKey =
            params.localNonceStorageKey ||
                _reown_appkit_common__WEBPACK_IMPORTED_MODULE_1__.SafeLocalStorageKeys.SIWX_NONCE_TOKEN;
        this.required = params.required ?? true;
        this.messenger = new _ReownAuthenticationMessenger_js__WEBPACK_IMPORTED_MODULE_7__.ReownAuthenticationMessenger({
            getNonce: this.getNonce.bind(this)
        });
    }
    async createMessage(input) {
        return this.messenger.createMessage(input);
    }
    async addSession(session) {
        const response = await this.request({
            method: 'POST',
            key: 'authenticate',
            body: {
                data: session.data,
                message: session.message,
                signature: session.signature,
                clientId: this.getClientId(),
                walletInfo: this.getWalletInfo()
            },
            headers: ['nonce', 'otp']
        });
        this.setStorageToken(response.token, this.localAuthStorageKey);
        this.emit('sessionChanged', session);
        this.setAppKitAccountUser(jwtDecode(response.token));
        this.otpUuid = null;
    }
    async getSessions(chainId, address) {
        try {
            if (!this.getStorageToken(this.localAuthStorageKey)) {
                return [];
            }
            const account = await this.request({
                method: 'GET',
                key: 'me',
                query: {},
                headers: ['auth']
            });
            if (!account) {
                return [];
            }
            const isSameAddress = account.address.toLowerCase() === address.toLowerCase();
            const isSameNetwork = account.caip2Network === chainId;
            if (!isSameAddress || !isSameNetwork) {
                return [];
            }
            const session = {
                data: {
                    accountAddress: account.address,
                    chainId: account.caip2Network
                },
                message: '',
                signature: ''
            };
            this.emit('sessionChanged', session);
            this.setAppKitAccountUser(account);
            return [session];
        }
        catch {
            return [];
        }
    }
    async revokeSession(_chainId, _address) {
        return Promise.resolve(this.clearStorageTokens());
    }
    async setSessions(sessions) {
        if (sessions.length === 0) {
            this.clearStorageTokens();
        }
        else {
            const session = (sessions.find(s => s.data.chainId === (0,_utils_ChainControllerUtil_js__WEBPACK_IMPORTED_MODULE_6__.getActiveCaipNetwork)()?.caipNetworkId) || sessions[0]);
            await this.addSession(session);
        }
    }
    getRequired() {
        return this.required;
    }
    async getSessionAccount() {
        if (!this.getStorageToken(this.localAuthStorageKey)) {
            throw new Error('Not authenticated');
        }
        return this.request({
            method: 'GET',
            key: 'me',
            body: undefined,
            query: {
                includeAppKitAccount: true
            },
            headers: ['auth']
        });
    }
    async setSessionAccountMetadata(metadata = null) {
        if (!this.getStorageToken(this.localAuthStorageKey)) {
            throw new Error('Not authenticated');
        }
        return this.request({
            method: 'PUT',
            key: 'account-metadata',
            body: { metadata },
            headers: ['auth']
        });
    }
    on(event, callback) {
        this.listeners[event].push(callback);
        return () => {
            this.listeners[event] = this.listeners[event].filter(cb => cb !== callback);
        };
    }
    removeAllListeners() {
        const keys = Object.keys(this.listeners);
        keys.forEach(key => {
            this.listeners[key] = [];
        });
    }
    async requestEmailOtp({ email, account }) {
        const otp = await this.request({
            method: 'POST',
            key: 'otp',
            body: { email, account }
        });
        this.otpUuid = otp.uuid;
        this.messenger.resources = [`email:${email}`];
        return otp;
    }
    confirmEmailOtp({ code }) {
        return this.request({
            method: 'PUT',
            key: 'otp',
            body: { code },
            headers: ['otp']
        });
    }
    async request({ method, key, query, body, headers }) {
        const { projectId, st, sv } = this.getSDKProperties();
        const url = new URL(`${_reown_appkit_common__WEBPACK_IMPORTED_MODULE_0__.ConstantsUtil.W3M_API_URL}/auth/v1/${String(key)}`);
        url.searchParams.set('projectId', projectId);
        url.searchParams.set('st', st);
        url.searchParams.set('sv', sv);
        if (query) {
            Object.entries(query).forEach(([queryKey, queryValue]) => url.searchParams.set(queryKey, String(queryValue)));
        }
        const response = await fetch(url, {
            method,
            body: body ? JSON.stringify(body) : undefined,
            headers: Array.isArray(headers)
                ? headers.reduce((acc, header) => {
                    switch (header) {
                        case 'nonce':
                            acc['x-nonce-jwt'] = `Bearer ${this.getStorageToken(this.localNonceStorageKey)}`;
                            break;
                        case 'auth':
                            acc['Authorization'] = `Bearer ${this.getStorageToken(this.localAuthStorageKey)}`;
                            break;
                        case 'otp':
                            if (this.otpUuid) {
                                acc['x-otp'] = this.otpUuid;
                            }
                            break;
                        default:
                            break;
                    }
                    return acc;
                }, {})
                : undefined
        });
        if (!response.ok) {
            throw new Error(await response.text());
        }
        if (response.headers.get('content-type')?.includes('application/json')) {
            return response.json();
        }
        return null;
    }
    getStorageToken(key) {
        return _reown_appkit_common__WEBPACK_IMPORTED_MODULE_1__.SafeLocalStorage.getItem(key);
    }
    setStorageToken(token, key) {
        _reown_appkit_common__WEBPACK_IMPORTED_MODULE_1__.SafeLocalStorage.setItem(key, token);
    }
    clearStorageTokens() {
        this.otpUuid = null;
        _reown_appkit_common__WEBPACK_IMPORTED_MODULE_1__.SafeLocalStorage.removeItem(this.localAuthStorageKey);
        _reown_appkit_common__WEBPACK_IMPORTED_MODULE_1__.SafeLocalStorage.removeItem(this.localNonceStorageKey);
        this.emit('sessionChanged', undefined);
    }
    async getNonce() {
        const { nonce, token } = await this.request({
            method: 'GET',
            key: 'nonce'
        });
        this.setStorageToken(token, this.localNonceStorageKey);
        return nonce;
    }
    getClientId() {
        return _controllers_BlockchainApiController_js__WEBPACK_IMPORTED_MODULE_4__.BlockchainApiController.state.clientId;
    }
    getWalletInfo() {
        const { connectedWalletInfo } = _controllers_AccountController_js__WEBPACK_IMPORTED_MODULE_2__.AccountController.state;
        if (!connectedWalletInfo) {
            return undefined;
        }
        if ('social' in connectedWalletInfo) {
            const social = connectedWalletInfo['social'];
            const identifier = connectedWalletInfo['identifier'];
            return { type: 'social', social, identifier };
        }
        const { name, icon } = connectedWalletInfo;
        let type = 'unknown';
        switch (connectedWalletInfo['type']) {
            case 'EXTERNAL':
            case 'INJECTED':
            case 'ANNOUNCED':
                type = 'extension';
                break;
            case 'WALLET_CONNECT':
                type = 'walletconnect';
                break;
            default:
                type = 'unknown';
        }
        return {
            type,
            name,
            icon
        };
    }
    getSDKProperties() {
        return _controllers_ApiController_js__WEBPACK_IMPORTED_MODULE_3__.ApiController._getSdkProperties();
    }
    emit(event, data) {
        this.listeners[event].forEach(listener => listener(data));
    }
    setAppKitAccountUser(session) {
        const { email } = session;
        if (email) {
            Object.values(_reown_appkit_common__WEBPACK_IMPORTED_MODULE_0__.ConstantsUtil.CHAIN).forEach(chainNamespace => {
                _controllers_ChainController_js__WEBPACK_IMPORTED_MODULE_5__.ChainController.setAccountProp('user', { email }, chainNamespace);
            });
        }
    }
}
/**
 * Decodes a JWT token and returns its payload
 * @param token - The JWT token to decode
 * @returns The decoded payload or null if invalid
 */
function jwtDecode(token) {
    // Split the token into parts
    const parts = token.split('.');
    // Check if the token has the correct format (header.payload.signature)
    if (parts.length !== 3) {
        throw new Error('Invalid token');
    }
    // Decode the payload (second part)
    const payload = parts[1];
    if (typeof payload !== 'string') {
        throw new Error('Invalid token');
    }
    // Convert base64url to base64
    const base64 = payload.replace(/-/gu, '+').replace(/_/gu, '/');
    // Add padding if needed
    const padded = base64.padEnd(base64.length + ((4 - (base64.length % 4)) % 4), '=');
    // Decode and parse the JSON
    const decoded = JSON.parse(atob(padded));
    return decoded;
}
//# sourceMappingURL=ReownAuthentication.js.map

/***/ }),

/***/ "./node_modules/@reown/appkit-controllers/dist/esm/src/features/reown-authentication/ReownAuthenticationMessenger.js":
/*!***************************************************************************************************************************!*\
  !*** ./node_modules/@reown/appkit-controllers/dist/esm/src/features/reown-authentication/ReownAuthenticationMessenger.js ***!
  \***************************************************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ReownAuthenticationMessenger: () => (/* binding */ ReownAuthenticationMessenger)
/* harmony export */ });
/* harmony import */ var _reown_appkit_common__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @reown/appkit-common */ "./node_modules/@reown/appkit-common/dist/esm/src/utils/NetworkUtil.js");
/* harmony import */ var _controllers_ChainController_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ../../controllers/ChainController.js */ "./node_modules/@reown/appkit-controllers/dist/esm/src/controllers/ChainController.js");


class ReownAuthenticationMessenger {
    constructor(params) {
        this.getNonce = params.getNonce;
    }
    async createMessage(input) {
        const params = {
            accountAddress: input.accountAddress,
            chainId: input.chainId,
            version: '1',
            domain: typeof document === 'undefined' ? 'Unknown Domain' : document.location.host,
            uri: typeof document === 'undefined' ? 'Unknown URI' : document.location.href,
            resources: this.resources,
            nonce: await this.getNonce(input),
            issuedAt: this.stringifyDate(new Date()),
            statement: undefined,
            expirationTime: undefined,
            notBefore: undefined
        };
        const methods = {
            toString: () => this.stringify(params)
        };
        return Object.assign(params, methods);
    }
    stringify(params) {
        const networkName = this.getNetworkName(params.chainId);
        return [
            `${params.domain} wants you to sign in with your ${networkName} account:`,
            params.accountAddress,
            params.statement ? `\n${params.statement}\n` : '',
            `URI: ${params.uri}`,
            `Version: ${params.version}`,
            `Chain ID: ${params.chainId}`,
            `Nonce: ${params.nonce}`,
            params.issuedAt && `Issued At: ${params.issuedAt}`,
            params.expirationTime && `Expiration Time: ${params.expirationTime}`,
            params.notBefore && `Not Before: ${params.notBefore}`,
            params.requestId && `Request ID: ${params.requestId}`,
            params.resources?.length &&
                params.resources.reduce((acc, resource) => `${acc}\n- ${resource}`, 'Resources:')
        ]
            .filter(line => typeof line === 'string')
            .join('\n')
            .trim();
    }
    getNetworkName(chainId) {
        const requestedNetworks = _controllers_ChainController_js__WEBPACK_IMPORTED_MODULE_1__.ChainController.getAllRequestedCaipNetworks();
        return _reown_appkit_common__WEBPACK_IMPORTED_MODULE_0__.NetworkUtil.getNetworkNameByCaipNetworkId(requestedNetworks, chainId);
    }
    stringifyDate(date) {
        return date.toISOString();
    }
}
//# sourceMappingURL=ReownAuthenticationMessenger.js.map

/***/ }),

/***/ "./node_modules/@reown/appkit-controllers/dist/esm/src/features/reown-authentication/index.js":
/*!****************************************************************************************************!*\
  !*** ./node_modules/@reown/appkit-controllers/dist/esm/src/features/reown-authentication/index.js ***!
  \****************************************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   ReownAuthentication: () => (/* reexport safe */ _ReownAuthentication_js__WEBPACK_IMPORTED_MODULE_0__.ReownAuthentication),
/* harmony export */   ReownAuthenticationMessenger: () => (/* reexport safe */ _ReownAuthenticationMessenger_js__WEBPACK_IMPORTED_MODULE_1__.ReownAuthenticationMessenger)
/* harmony export */ });
/* harmony import */ var _ReownAuthentication_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./ReownAuthentication.js */ "./node_modules/@reown/appkit-controllers/dist/esm/src/features/reown-authentication/ReownAuthentication.js");
/* harmony import */ var _ReownAuthenticationMessenger_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./ReownAuthenticationMessenger.js */ "./node_modules/@reown/appkit-controllers/dist/esm/src/features/reown-authentication/ReownAuthenticationMessenger.js");


//# sourceMappingURL=index.js.map

/***/ })

}]);